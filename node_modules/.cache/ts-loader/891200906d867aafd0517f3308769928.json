{"remainingRequest":"C:\\filmarket\\filmarket_dev\\node_modules\\babel-loader\\lib\\index.js!C:\\filmarket\\filmarket_dev\\node_modules\\ts-loader\\index.js??ref--13-2!C:\\filmarket\\filmarket_dev\\src\\utils\\http.ts","dependencies":[{"path":"C:\\filmarket\\filmarket_dev\\src\\utils\\http.ts","mtime":1642792975412},{"path":"C:\\filmarket\\filmarket_dev\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\filmarket\\filmarket_dev\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\filmarket\\filmarket_dev\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6L2ZpbG1hcmtldC9maWxtYXJrZXRfZGV2L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS1hbGwuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKaW1wb3J0IHNlc3Npb24gZnJvbSAnQC9zdG9yZS9tb2R1bGVzL3Nlc3Npb25Nb2R1bGUnOwppbXBvcnQgc3RvcmUgZnJvbSAnQC9zdG9yZSc7CmF4aW9zLmRlZmF1bHRzLndpdGhDcmVkZW50aWFscyA9IHRydWU7CnZhciBVUkwgPSAnaHR0cHM6Ly9hcGkuZmlsaWNhYmguY29tL2FwaS92MSc7CnZhciBodHRwID0gYXhpb3MuY3JlYXRlKHsKICBiYXNlVVJMOiBVUkwKfSk7CnZhciBpc0FscmVhZHlGZXRjaGluZ0FjY2Vzc1Rva2VuID0gZmFsc2U7Cmh0dHAuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKGZ1bmN0aW9uIChjb25maWcpIHsKICBzdG9yZS5jb21taXQoJ2xvYWRpbmcnLCB0cnVlKTsgLy8gT3B0aW9uYWwgaGVhZGVycwoKICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ190b2tlbicpKSB7CiAgICB2YXIgdG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnX3Rva2VuJyk7CiAgICB2YXIgdGsgPSB0b2tlbiA9PT0gbnVsbCB8fCB0b2tlbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogdG9rZW4ucmVwbGFjZUFsbCgnIicsICIiKTsKICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAiQmVhcmVyICIuY29uY2F0KHRrKTsKICAgIGNvbmZpZy5oZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi92bmQuYXBpK2pzb24nOwogIH0KCiAgcmV0dXJuIGNvbmZpZzsKfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKfSk7Cmh0dHAuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICBzdG9yZS5jb21taXQoJ2xvYWRpbmcnLCBmYWxzZSk7CiAgc3RvcmUuY29tbWl0KCdlcnJvcnMnLCB7fSk7CiAgc3RvcmUuY29tbWl0KCdlcnJvcicsIGZhbHNlKTsKICByZXR1cm4gcmVzcG9uc2U7Cn0sIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoZXJyb3IpIHsKICAgIHZhciBjb25maWcsIHN0YXR1cywgb3JpZ2luYWxSZXF1ZXN0LCBpc1JlZnJlc2hPaywgcmV0cnlPcmlnaW5hbFJlcXVlc3Q7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUicpOwogICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvci5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgc3RvcmUuY29tbWl0KCdsb2FkaW5nJywgZmFsc2UpOwogICAgICAgICAgICBzdG9yZS5jb21taXQoJ2Vycm9ycycsIGVycm9yLnJlc3BvbnNlLmRhdGEgfHwgewogICAgICAgICAgICAgICJub25lIjogW2Vycm9yLnJlc3BvbnNlLmRhdGFdCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzdG9yZS5jb21taXQoJ2Vycm9yJywgdHJ1ZSk7CiAgICAgICAgICAgIGNvbmZpZyA9IGVycm9yLmNvbmZpZywgc3RhdHVzID0gZXJyb3IucmVzcG9uc2Uuc3RhdHVzOwogICAgICAgICAgICBvcmlnaW5hbFJlcXVlc3QgPSBjb25maWc7CiAgICAgICAgICAgIGlzUmVmcmVzaE9rID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoIShzdGF0dXMgPT09IDQwMSkpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc0FscmVhZHlGZXRjaGluZ0FjY2Vzc1Rva2VuKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE1OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpc0FscmVhZHlGZXRjaGluZ0FjY2Vzc1Rva2VuID0gdHJ1ZTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEzOwogICAgICAgICAgICByZXR1cm4gc2Vzc2lvbi5nZXRSZWZyZXNoVG9rZW4oKTsKCiAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICBpc1JlZnJlc2hPayA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgIGlzQWxyZWFkeUZldGNoaW5nQWNjZXNzVG9rZW4gPSBmYWxzZTsKCiAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICBpZiAoIWlzUmVmcmVzaE9rKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXRyeU9yaWdpbmFsUmVxdWVzdCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShodHRwKG9yaWdpbmFsUmVxdWVzdCkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgcmV0cnlPcmlnaW5hbFJlcXVlc3QpOwoKICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIFByb21pc2UucmVqZWN0KGVycm9yKSk7CgogICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI0OwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlamVjdChlcnJvcikpOwoKICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZSk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gKF94KSB7CiAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKSk7CmV4cG9ydCB7IGh0dHAsIFVSTCB9Ow=="},{"version":3,"sources":["C:\\filmarket\\filmarket_dev\\src\\utils\\http.ts"],"names":[],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport session from '@/store/modules/sessionModule';\r\nimport store from '@/store';\r\naxios.defaults.withCredentials = true;\r\n\r\nconst URL  =  'https://api.filicabh.com/api/v1'\r\n\r\nconst http = axios.create({\r\n  baseURL: URL\r\n});\r\n\r\n\r\n\r\nlet isAlreadyFetchingAccessToken = false;\r\n  \r\nhttp.interceptors.request.use( (config) => {\r\n  store.commit('loading',true);\r\n  // Optional headers\r\n  if (localStorage.getItem('_token')) {\r\n    const token : any = localStorage.getItem('_token');\r\n    const tk  = token?.replaceAll('\"',\"\");\r\n    config.headers.Authorization = `Bearer ${tk}`;\r\n    config.headers['Content-Type'] = 'application/vnd.api+json'\r\n  }\r\n  return config;\r\n\r\n}, (error) => {\r\n  return Promise.reject(error);\r\n});\r\n\r\n\r\nhttp.interceptors.response.use( (response) => {\r\n\r\n  store.commit('loading',false);\r\n  store.commit('errors',{});\r\n  store.commit('error',false);\r\n  return response;\r\n\r\n}, async (error: any) => {\r\n  console.log('ERROR')\r\n  console.log(error.response.data)\r\n  store.commit('loading',false);\r\n  store.commit('errors',error.response.data || { \"none\": [error.response.data]  });\r\n  store.commit('error',true);\r\n  const { config, response: { status } } = error;\r\n  const originalRequest = config;\r\n  let isRefreshOk: boolean = false;\r\n\r\n  if (status === 401) {\r\n    if (!isAlreadyFetchingAccessToken) {\r\n      isAlreadyFetchingAccessToken = true;\r\n      isRefreshOk = await session.getRefreshToken();\r\n      isAlreadyFetchingAccessToken = false;\r\n    }\r\n    if (isRefreshOk) {\r\n      const retryOriginalRequest = new Promise((resolve) => {\r\n          resolve(http(originalRequest));\r\n      });\r\n      return retryOriginalRequest; \r\n    } else {\r\n      return Promise.reject(error); \r\n    }\r\n  } else { \r\n   return Promise.reject(error);\r\n  }\r\n});\r\n\r\n\r\nexport { http, URL};\r\n\r\n\r\n\r\n"],"sourceRoot":""}]}