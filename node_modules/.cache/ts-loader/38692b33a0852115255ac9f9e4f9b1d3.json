{"remainingRequest":"C:\\frontend\\filmarket\\node_modules\\babel-loader\\lib\\index.js!C:\\frontend\\filmarket\\node_modules\\ts-loader\\index.js??ref--13-2!C:\\frontend\\filmarket\\src\\utils\\http.ts","dependencies":[{"path":"C:\\frontend\\filmarket\\src\\utils\\http.ts","mtime":1642792975412},{"path":"C:\\frontend\\filmarket\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\frontend\\filmarket\\node_modules\\babel-loader\\lib\\index.js","mtime":59851904000},{"path":"C:\\frontend\\filmarket\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6L2Zyb250ZW5kL2ZpbG1hcmtldC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UtYWxsLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCBzZXNzaW9uIGZyb20gJ0Avc3RvcmUvbW9kdWxlcy9zZXNzaW9uTW9kdWxlJzsKaW1wb3J0IHN0b3JlIGZyb20gJ0Avc3RvcmUnOwpheGlvcy5kZWZhdWx0cy53aXRoQ3JlZGVudGlhbHMgPSB0cnVlOwp2YXIgVVJMID0gJ2h0dHBzOi8vYXBpLmZpbGljYWJoLmNvbS9hcGkvdjEnOwp2YXIgaHR0cCA9IGF4aW9zLmNyZWF0ZSh7CiAgYmFzZVVSTDogVVJMCn0pOwp2YXIgaXNBbHJlYWR5RmV0Y2hpbmdBY2Nlc3NUb2tlbiA9IGZhbHNlOwpodHRwLmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShmdW5jdGlvbiAoY29uZmlnKSB7CiAgc3RvcmUuY29tbWl0KCdsb2FkaW5nJywgdHJ1ZSk7IC8vIE9wdGlvbmFsIGhlYWRlcnMKCiAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdfdG9rZW4nKSkgewogICAgdmFyIHRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ190b2tlbicpOwogICAgdmFyIHRrID0gdG9rZW4gPT09IG51bGwgfHwgdG9rZW4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRva2VuLnJlcGxhY2VBbGwoJyInLCAiIik7CiAgICBjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gIkJlYXJlciAiLmNvbmNhdCh0ayk7CiAgICBjb25maWcuaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vdm5kLmFwaStqc29uJzsKICB9CgogIHJldHVybiBjb25maWc7Cn0sIGZ1bmN0aW9uIChlcnJvcikgewogIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7Cn0pOwpodHRwLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UoZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgc3RvcmUuY29tbWl0KCdsb2FkaW5nJywgZmFsc2UpOwogIHN0b3JlLmNvbW1pdCgnZXJyb3JzJywge30pOwogIHN0b3JlLmNvbW1pdCgnZXJyb3InLCBmYWxzZSk7CiAgcmV0dXJuIHJlc3BvbnNlOwp9LCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKGVycm9yKSB7CiAgICB2YXIgY29uZmlnLCBzdGF0dXMsIG9yaWdpbmFsUmVxdWVzdCwgaXNSZWZyZXNoT2ssIHJldHJ5T3JpZ2luYWxSZXF1ZXN0OwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBjb25zb2xlLmxvZygnRVJST1InKTsKICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIHN0b3JlLmNvbW1pdCgnbG9hZGluZycsIGZhbHNlKTsKICAgICAgICAgICAgc3RvcmUuY29tbWl0KCdlcnJvcnMnLCBlcnJvci5yZXNwb25zZS5kYXRhIHx8IHsKICAgICAgICAgICAgICAibm9uZSI6IFtlcnJvci5yZXNwb25zZS5kYXRhXQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc3RvcmUuY29tbWl0KCdlcnJvcicsIHRydWUpOwogICAgICAgICAgICBjb25maWcgPSBlcnJvci5jb25maWcsIHN0YXR1cyA9IGVycm9yLnJlc3BvbnNlLnN0YXR1czsKICAgICAgICAgICAgb3JpZ2luYWxSZXF1ZXN0ID0gY29uZmlnOwogICAgICAgICAgICBpc1JlZnJlc2hPayA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKCEoc3RhdHVzID09PSA0MDEpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIzOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXNBbHJlYWR5RmV0Y2hpbmdBY2Nlc3NUb2tlbikgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaXNBbHJlYWR5RmV0Y2hpbmdBY2Nlc3NUb2tlbiA9IHRydWU7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMzsKICAgICAgICAgICAgcmV0dXJuIHNlc3Npb24uZ2V0UmVmcmVzaFRva2VuKCk7CgogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgaXNSZWZyZXNoT2sgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICBpc0FscmVhZHlGZXRjaGluZ0FjY2Vzc1Rva2VuID0gZmFsc2U7CgogICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgaWYgKCFpc1JlZnJlc2hPaykgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0cnlPcmlnaW5hbFJlcXVlc3QgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICAgIHJlc29sdmUoaHR0cChvcmlnaW5hbFJlcXVlc3QpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHJldHJ5T3JpZ2luYWxSZXF1ZXN0KTsKCiAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlamVjdChlcnJvcikpOwoKICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNDsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZWplY3QoZXJyb3IpKTsKCiAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCkpOwpleHBvcnQgeyBodHRwLCBVUkwgfTs="},{"version":3,"sources":["C:\\frontend\\filmarket\\src\\utils\\http.ts"],"names":[],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport session from '@/store/modules/sessionModule';\r\nimport store from '@/store';\r\naxios.defaults.withCredentials = true;\r\n\r\nconst URL  =  'https://api.filicabh.com/api/v1'\r\n\r\nconst http = axios.create({\r\n  baseURL: URL\r\n});\r\n\r\n\r\n\r\nlet isAlreadyFetchingAccessToken = false;\r\n  \r\nhttp.interceptors.request.use( (config) => {\r\n  store.commit('loading',true);\r\n  // Optional headers\r\n  if (localStorage.getItem('_token')) {\r\n    const token : any = localStorage.getItem('_token');\r\n    const tk  = token?.replaceAll('\"',\"\");\r\n    config.headers.Authorization = `Bearer ${tk}`;\r\n    config.headers['Content-Type'] = 'application/vnd.api+json'\r\n  }\r\n  return config;\r\n\r\n}, (error) => {\r\n  return Promise.reject(error);\r\n});\r\n\r\n\r\nhttp.interceptors.response.use( (response) => {\r\n\r\n  store.commit('loading',false);\r\n  store.commit('errors',{});\r\n  store.commit('error',false);\r\n  return response;\r\n\r\n}, async (error: any) => {\r\n  console.log('ERROR')\r\n  console.log(error.response.data)\r\n  store.commit('loading',false);\r\n  store.commit('errors',error.response.data || { \"none\": [error.response.data]  });\r\n  store.commit('error',true);\r\n  const { config, response: { status } } = error;\r\n  const originalRequest = config;\r\n  let isRefreshOk: boolean = false;\r\n\r\n  if (status === 401) {\r\n    if (!isAlreadyFetchingAccessToken) {\r\n      isAlreadyFetchingAccessToken = true;\r\n      isRefreshOk = await session.getRefreshToken();\r\n      isAlreadyFetchingAccessToken = false;\r\n    }\r\n    if (isRefreshOk) {\r\n      const retryOriginalRequest = new Promise((resolve) => {\r\n          resolve(http(originalRequest));\r\n      });\r\n      return retryOriginalRequest; \r\n    } else {\r\n      return Promise.reject(error); \r\n    }\r\n  } else { \r\n   return Promise.reject(error);\r\n  }\r\n});\r\n\r\n\r\nexport { http, URL};\r\n\r\n\r\n\r\n"],"sourceRoot":""}]}